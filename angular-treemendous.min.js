!function(e){"use strict";function n(e,n){var t=null;return function(r){r.stopPropagation();var i=!t;n.cancel(t),t=n(function(){t=null},300),i&&e.apply(this,arguments)}}var t=e.$$minErr("treemendous");e.module("treemendous",["ngAnimate"]).factory("treemendousParser",["$parse",function(e){var n=/^s*([\s\S]+?)(?:\s+group\s+by\s+([\$\w][\$\w\d]*)(?:\s+as\s+([\$\w][\$\w\d]*))?)?$/;return{parse:function(r){var i=r.match(n);if(!i)throw t("iexp","Expected expression in the form of '_nodes_ (group by _property_ (as _children_)?)?' but got '{0}'.",r);return{nodes:e(i[1]),groupBy:i[2]||!1,children:i[3]||"children"}}}}]).controller("TreeMendousCtrl",["$animate","treemendousParser",function(e,n){function t(e,n){for(var t,s,o=i.children,c=i.groupBy,a={},d=0,l=n.length;l>d;d++)s=n[d],t=s[c],a[t]?a[t][o].push(s):(a[t]={},a[t][o]=[s],a[t][c]=t);for(a=Object.keys(a).map(function(e){return a[e]}),d=0,l=a.length;l>d;d++)t=a[d],e.nodes.some(r(t))||e.nodes.push(t)}function r(e){var n=i.children,t=i.groupBy;return function(r){return r[t]===e[t]?(e[n].forEach(function(e){~r[n].indexOf(e)||r[n].push(e)}),!0):!1}}this.transclude=null,this.expression="",this.selectMode="none";var i,s=[],o=[];this.registerSelect=function(e,n){return s.push(e),o.push(n),function(){var t=s.indexOf(e),r=o.indexOf(n);t>-1&&s.splice(t,1),r>-1&&o.splice(r,1)}},this.select=function(n,t){if("none"!=this.selectMode&&~s.indexOf(n)){if(~["single","active"].indexOf(this.selectMode))for(var r=0,i=s.length;i>r;r++)e.removeClass(s[r],"selected"),o[r].$selected=!1;e.addClass(n,"selected"),t.$selected=!0,"active"==this.selectMode&&(e.addClass(n,"active"),t.$active=!0)}},this.deselect=function(n,t){e.removeClass(n,"active"),e.removeClass(n,"selected"),t.$active=!1,t.$selected=!1},this.expand=function(n,t){e.removeClass(n,"tree-branch-collapsed"),e.addClass(n,"tree-branch-expanded"),t.$expanded=!0},this.collapse=function(n,t){e.removeClass(n,"tree-branch-expanded"),e.addClass(n,"tree-branch-collapsed"),t.$expanded=!1},this.watch=function(e,r,s){i||(i=n.parse(this.expression));var o=s?n.parse(s).nodes:i.nodes;r.$watchCollection(o,function(n){return n?!i.groupBy||r.$intermediate?(e.$intermediate=!1,e.nodes=n):(e.$intermediate=!0,void t(e,n)):e.nodes=[]}),i.groupBy&&e.$watchCollection(o,function(n,t){if(n&&0!==n.length&&n!==t&&!e.$intermediate){for(var i=r;i.$intermediate===!0;)i=i.$parent;o(i)&&o.assign(i,n)}})}}]).directive("treeMendous",function(){var e={single:"single",multi:"multi",active:"active",none:"none"};return{restrict:"EA",transclude:!0,controller:"TreeMendousCtrl",link:function(n,t,r,i,s){i.selectMode=e[r.selectMode]||"none",i.transclude=s,i.expression=r.nodes||"";var o=n.$new();o.nodes=[],s(o,function(e){t.append(e)}),i.watch(o,n)}}}).directive("treeBranch",function(){return{restrict:"EA",require:"^treeMendous",link:function(e,n,t,r){var i=e.$new();i.nodes=[],r.transclude(i,function(e){n.append(e)}),r.watch(i,e,t.nodes)}}}).directive("treeSelect",["$q","$timeout",function(e,t){return{restrict:"EA",require:"^treeMendous",link:function(r,i,s,o){if("none"!=o.selectMode){var c=s.selectOn||"click",a=s.treeSelect||s.selectIf||!0;r.$on("$destroy",o.registerSelect(i,r)),r.$selected=!1,r.$active=!1;var d=function(n){return n.stopPropagation(),r.$selected?r.$apply(function(){o.deselect(i,r)}):void e.when(r.$eval(a,{$event:n})).then(function(e){e!==!1&&o.select(i,r)})};i.on(c,"click"==c?n(d,t):d)}}}}]).directive("treeExpand",["$q","$timeout",function(e,t){return{restrict:"EA",require:"^treeMendous",link:function(r,i,s,o){var c=s.expandOn||"click",a=s.treeExpand||s.expand||!0;void 0===s.treeSelect&&"tree-select"!=i[0].tagName&&"data-tree-select"!=i[0].tagName||s.expandOn||(c="dblclick"),r.$expanded=!1;var d=function(n){return n.stopPropagation(),r.$expanded?r.$apply(function(){o.collapse(i,r)}):void e.when(r.$eval(a,{$event:n})).then(function(e){e!==!1&&o.expand(i,r)})};i.on(c,"click"==c?n(d,t):d)}}}])}(angular);